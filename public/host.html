<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>الهوست - لعبة المافيا</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* إعدادات الخطوط والواجهة العامة */
    body {
      margin: 0;
      font-family: 'Cairo', sans-serif;
      background-color: #1e1e2f;
      color: white;
    }

    .container {
      padding: 30px;
    }

    /* .round-info */
    .round-info {
      background: linear-gradient(135deg, #2d2d44, #3a3a5c);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.3);
      color: white;
      margin-bottom: 30px;
      text-align: center;
    }

    /* رأس الجولة - round header */
    .round-header {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    /* .round-block */
    .round-block {
      background-color: #3a3a5c;
      border-radius: 10px;
      padding: 15px 20px;
      margin: 10px;
      width: 140px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    /* الإحصائيات */
    .stats {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .stat-block {
      background-color: #3a3a5c;
      border-radius: 10px;
      padding: 10px 15px;
      width: 140px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      position: relative;
    }

    .round-value {
      font-size: 24px;
      font-weight: bold;
      display: block;
      margin-top: 5px;
      color: #ffcc00;
    }

    .eye-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    .eye-btn:hover {
      color: #ffcc00;
    }

    /* مظهر لاعبي اللعبة */
    .players {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    /* .player-card */
    .player-card {
      background-color: #3a3a5c;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      position: relative;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s;
    }

    .player-card.mafia {
      background-color: #d32f2f;
    }

    .player-card:hover {
      transform: scale(1.05);
    }

    .player-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 10px;
    }

    .vote-count {
      position: absolute;
      top: 8px;
      right: 8px;
      background: #f44336;
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 16px;
    }

    /* الأزرار */
    .vote-btn, .mafia-btn, .action-btn, .back-button {
      margin-top: 15px;
      padding: 12px 20px;
      background-color: #ffcc00;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: black;
      font-size: 14px;
      width: 100%;
      transition: background-color 0.3s;
    }

    .vote-btn:hover, .mafia-btn:hover, .action-btn:hover, .back-button:hover {
      background-color: #f44336;
      color: white;
    }

    .chat-section, .gifts-section, .host-section {
      background-color: #2d2d44;
      padding: 20px;
      border-radius: 15px;
      margin-top: 20px;
    }

    #chatBox {
      height: 150px;
      overflow-y: auto;
      background: #1e1e2f;
      padding: 10px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid #444;
    }

    .chat-message {
      margin: 5px 0;
    }

    .chat-input-wrapper {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }

    #chatInput {
      flex: 1;
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #444;
      background: #1e1e2f;
      color: white;
      font-size: 14px;
    }

    #sendButton {
      padding: 15px 20px;
      border-radius: 10px;
      background-color: #ffcc00;
      color: black;
      border: none;
      cursor: pointer;
      font-size: 14px;
    }

    #sendButton:hover {
      background-color: #f44336;
      color: white;
    }

    select {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      margin-top: 10px;
      background: #1e1e2f;
      color: white;
      border: 1px solid #444;
    }

    .gifts button {
      margin: 10px;
      padding: 15px;
      border: none;
      border-radius: 15px;
      background-color: #ffcc00;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.3s;
    }

    .gifts button:hover {
      background-color: #f44336;
      color: white;
    }

    .eye-icon {
      cursor: pointer;
      font-size: 20px;
      margin-left: 15px;
      transition: color 0.3s;
    }

    .eye-icon:hover {
      color: #ffcc00;
    }

    /* إعدادات اللعبة */
    .settings-box {
      background-color: #2d2d44;
      padding: 25px;
      margin-top: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    h3 {
      color: #ffcc00;
      margin-bottom: 20px;
      font-size: 22px;
    }

    /* التنسيق داخل إعدادات اللعبة */
    .setting-item {
      margin: 15px 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 18px;
      color: white;
    }

    .checkbox-label {
      position: relative;
      padding-left: 40px;
      cursor: pointer;
      user-select: none;
      display: inline-block;
      line-height: 24px;
      font-size: 18px;
      color: white;
    }

    .checkbox-label input {
      position: absolute;
      opacity: 0;
      cursor: pointer;
      height: 0;
      width: 0;
    }

    .checkmark {
      position: absolute;
      top: 0;
      left: 0;
      height: 24px;
      width: 24px;
      background-color: #1e1e2f;
      border: 2px solid #ffcc00;
      border-radius: 5px;
      transition: background-color 0.2s, box-shadow 0.2s;
    }

    .checkbox-label input:checked ~ .checkmark {
      background-color: #ffcc00;
      box-shadow: 0 0 5px #ffcc00;
    }

    .checkmark:after {
      content: "";
      position: absolute;
      display: none;
    }

    .checkbox-label input:checked ~ .checkmark:after {
      display: block;
    }

    .checkbox-label .checkmark:after {
      left: 7px;
      top: 2px;
      width: 7px;
      height: 14px;
      border: solid #1e1e2f;
      border-width: 0 3px 3px 0;
      transform: rotate(45deg);
    }

    /* زر الرجوع إلى الصفحة الرئيسية */
    #backToHomeButton {
      padding: 15px 25px;
      background-color: #888;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      width: 100%;
      margin-top: 20px;
      transition: background-color 0.3s;
    }

    #backToHomeButton:hover {
      background-color: #f44336;
    }
    .transfer-host-section {
        background-color: #2d2d44;
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        text-align: center;
        color: white;
        animation: fadeIn 0.5s ease-out;
    }

    .transfer-host-section h3 {
        color: #ffcc00;
        font-size: 24px;
        margin-bottom: 20px;
    }

    .transfer-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
        justify-content: center;
        align-items: center;
    }

    .transfer-list button {
        padding: 12px 20px;
        background-color: #ffcc00;
        color: black;
        font-size: 16px;
        border: none;
        border-radius: 10px;
        width: 200px;
        cursor: pointer;
        transition: background-color 0.3s, transform 0.2s;
    }

    .transfer-list button:hover {
        background-color: #f44336;
        transform: scale(1.05);
        color: white;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }
        to {
            opacity: 1;
        }
    }
    .gift-anim {
      position: absolute;
      z-index: 10;
      font-size: 30px;
      animation: flyGift 1s ease-in-out forwards;
    }
    @keyframes flyGift {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(50px, -120px) scale(1.5); opacity: 0; }
    }
    .status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      position: absolute;
      top: 8px;
      left: 8px; 
    }
    .online { background: green; }
    .idle { background: orange; }
    .offline { background: gray; }
    .room-info {
      background-color: #2d2d44;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    .chat-section, .gifts-section {
      margin-top: 25px;
      background-color: #2d2d44;
      padding: 15px;
      border-radius: 10px;
    }
    .start-button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: #00cc66;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .kick-button {
      margin-top: 10px;
      padding: 5px 10px;
      background-color: #ff4d4d;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="room-info">
      <h2>مرحباً، <span id="playerName"></span></h2>
      <p>رقم الطاولة: <strong id="roomCode"></strong></p>
    </div>

    <h3>اللاعبون المتصلون</h3>
    <div class="players" id="playersList"></div>

    <div class="chat-section">
      <h4>الدردشة</h4>
      <div id="chatBox"></div>
      <div class="chat-input-wrapper">
        <input type="text" id="chatInput" placeholder="اكتب رسالة...">
        <button id="sendButton" onclick="sendMessage()">إرسال</button>
      </div>
    </div>

    <div class="gifts-section">
      <h4>أرسل هدية</h4>
      <select id="giftTarget">
        <option value="all">لكل اللاعبين</option>
      </select>
      <div class="gifts">
        <button onclick="sendGift('🌹')">🌹 وردة</button>
        <button onclick="sendGift('🍅')">🍅 طماطة</button>
        <button onclick="sendGift('💣')">💣 قنبلة</button>
        <button onclick="sendGift('🐴')">🐴 حمار</button>
        <button onclick="sendGift('😢')">😢 بكاء</button>
        <button onclick="sendGift('😂')">😂 ضحك</button>
      </div>
    </div>
    <div class="settings-box gifts">
      <div>
        <h3>⚙️ الإعدادات</h3>
        <!-- عرض الاصوات في اللعبة -->
        <div class="setting-item">
          <label class="checkbox-label">
            <input type="checkbox" id="toggleSounds" checked />
            <span class="checkmark"></span>
            تفعيل الأصوات في اللعبة 🔊
          </label>
        </div>
      </div>
    </div>
    <button class="start-button" onclick="startGame()">ابدأ اللعبة</button>
    <button onclick="goToHome()" id="backToHomeButton" style="margin-top: 20px; padding: 12px 20px; background-color: #888; color: white; border: none; border-radius: 10px; cursor: pointer;">
      🔙 رجوع إلى الصفحة الرئيسية
    </button>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    function playSound(id) {
      const enableSounds = document.getElementById('toggleSounds')?.checked;
      if (!enableSounds) return;

      const audio = document.getElementById(id);
      if (audio) {
        audio.currentTime = 0;
        audio.play();
      }
    }
    function goToHome() {
        window.location.href = 'index.html';
    }
    const socket = io("https://gamemafia.onrender.com", {
      transports: ["websocket", "polling"]
    });
    const playerName = getCookie('playerName');
    const roomCode = getCookie('roomCode');

    if (!playerName || !roomCode) {
      window.location.href = 'index.html';
    }

    document.getElementById('playerName').textContent = playerName;
    document.getElementById('roomCode').textContent = roomCode;

    socket.emit('player-join-room', { playerName, roomCode });

    socket.on('update-players', players => {
      const list = document.getElementById('playersList');
      const targetSelect = document.getElementById('giftTarget');
      list.innerHTML = '';
      targetSelect.innerHTML = '<option value="all">لكل اللاعبين</option>';

      players.forEach(player => {
        const statusClass = player.status === 'online' ? 'online' : player.status === 'idle' ? 'idle' : 'offline';
        const cardId = `player-${player.name.replace(/\s/g, '-')}`;
        list.innerHTML += `
          <div class="player-card" id="${cardId}">
            <div class="status ${statusClass}"></div>
            <img src="https://api.dicebear.com/7.x/bottts/svg?seed=${player.name}" />
            <h4>${player.name}</h4>
            <button class="kick-button" onclick="kickPlayer('${player.name}')">طرد</button>
          </div>
        `;
        targetSelect.innerHTML += `<option value="${player.name}">${player.name}</option>`;
      });
    });

    function sendMessage() {
      const msg = document.getElementById('chatInput').value.trim();
      if (!msg) return;
      socket.emit('chat-message', { roomCode, playerName, message: msg });
      document.getElementById('chatInput').value = '';
    }

    document.getElementById('chatInput').addEventListener('keydown', function (e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
      }
    });

    socket.on('chat-message', ({ playerName, message }) => {
      const box = document.getElementById('chatBox');
      const div = document.createElement('div');
      div.className = 'chat-message';
      div.innerHTML = `<strong>${playerName}:</strong> ${message}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    });

    function sendGift(gift) {
      const target = document.getElementById('giftTarget').value;
      socket.emit('send-gift', { roomCode, playerName, gift, target });
    }

    socket.on('receive-gift', ({ playerName: sender, gift, target }) => {
      let recipientList;

      // 🟡 تشغيل الصوت حسب نوع الهدية
      const giftSounds = {
        '🌹': 'sound-rose',
        '🍅': 'sound-tomato',
        '💣': 'sound-bomb',
        '🐴': 'sound-donkey',
        '😢': 'a',
        '😂': 'b'
      };
      const audioId = giftSounds[gift];
      if (audioId) {
        playSound(audioId);
      }

      // 🎯 تحديد المستلمين
      if (target === 'all') {
        recipientList = Array.from(document.querySelectorAll('.player-card'));
      } else {
        recipientList = [document.getElementById(`card-${target}`)];
      }

      // ✨ تنفيذ الأنيميشن للهدية
      recipientList.forEach(card => {
        if (!card) return;
        const anim = document.createElement('div');
        anim.className = 'gift-anim';
        anim.textContent = gift;
        card.appendChild(anim);
        setTimeout(() => anim.remove(), 1000);
      });

      // 📝 إضافة رسالة إلى الدردشة
      const box = document.getElementById('chatBox');
      const div = document.createElement('div');
      const msg = target === 'all'
        ? `${sender} أرسل هدية ${gift} للجميع 🎁`
        : `${sender} أرسل ${gift} إلى ${target}`;
      div.className = 'chat-message';
      div.innerHTML = `<em>${msg}</em>`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    });

    function kickPlayer(playerName) {
      socket.emit('kick-player', { roomCode, playerName });
    }

    function startGame() {
      socket.emit('start-game', { roomCode });
    }

    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }
    socket.on('game-started', ({ role, roomCode, round }) => {
      document.cookie = `role=${role}; path=/`;
      document.cookie = `round=${round}; path=/`;
      window.location.href = 'game.html';
    });
  </script>
  <script>
    // 🎤🔊 واجهة التحكم بالصوت
    (function initVoiceUI() {
      const container = document.querySelector('.container') || document.body;

      const wrap = document.createElement('div');
      wrap.className = 'voice-controls';
      wrap.style.cssText = `
        display:flex; gap:8px; align-items:center; margin:12px 0;
        padding:8px; border:1px solid #eee; border-radius:12px;
      `;

      const micBtn = document.createElement('button');
      micBtn.id = 'micButton';
      micBtn.textContent = '🎤'; 
      micBtn.title = 'تشغيل/إيقاف الميكروفون';
      micBtn.style.cssText = 'font-size:18px; padding:8px 12px; border-radius:10px;';

      const spkBtn = document.createElement('button');
      spkBtn.id = 'speakerButton';
      spkBtn.textContent = '🔊'; 
      spkBtn.title = 'تشغيل/كتم السماعات';
      spkBtn.style.cssText = 'font-size:18px; padding:8px 12px; border-radius:10px;';

      const hint = document.createElement('span');
      hint.textContent = 'المحادثة الصوتية';
      hint.style.cssText = 'opacity:.8; font-size:14px; margin-inline-start:6px;';

      wrap.appendChild(micBtn);
      wrap.appendChild(spkBtn);
      wrap.appendChild(hint);

      const anchor = document.querySelector('.players') || container.firstChild;
      container.insertBefore(wrap, anchor);

      // ✅ شغل المايك مباشرة بعد إنشاء الأزرار
      window.addEventListener("load", () => {
        // setTimeout(() => {
          micBtn.click(); // كأن المستخدم ضغط على زر الميكروفون
        // }, 100); // نصف ثانية عشان تتأكد الأزرار أنشئت بالكامل
      });
    })();

    let localStream = null;
    let micOn = false;
    let speakersOn = true;
    const peers = {};
    const peerAudioEls = {};

    function updateMicIcon() {
      const btn = document.getElementById('micButton');
      if (!btn) return;
      btn.textContent = micOn ? '🛑' : '🎤';
    }

    function updateSpeakerIcon() {
      const btn = document.getElementById('speakerButton');
      if (!btn) return;
      btn.textContent = speakersOn ? '🔊' : '🔇';
    }

    function createRemoteAudioEl(peerId) {
      let audio = peerAudioEls[peerId];
      if (!audio) {
        audio = document.createElement('audio');
        audio.id = `voice-audio-${peerId}`;
        audio.autoplay = true;
        audio.playsInline = true; // مهم جدًا للجوال
        audio.muted = !speakersOn;
        document.body.appendChild(audio);
        peerAudioEls[peerId] = audio;
      }
      return audio;
    }

    function removePeer(peerId) {
      try {
        const pc = peers[peerId];
        if (pc) {
          // لا توقف s.track (المحلي)! فقط أغلق الاتصال ونظّف.
          try {
            pc.getSenders().forEach(sender => {
              try { pc.removeTrack(sender); } catch {}
            });
          } catch {}

          pc.onicecandidate = null;
          pc.ontrack = null;
          pc.onconnectionstatechange = null;

          try { pc.close(); } catch {}
        }
      } catch {}

      delete peers[peerId];

      const audio = peerAudioEls[peerId];
      if (audio) {
        try { audio.srcObject = null; } catch {}
        audio.remove();
        delete peerAudioEls[peerId];
      }
    }

    function createPeerConnection(peerId) {
      var pc = new RTCPeerConnection({
        iceServers: [
            {
              urls: "stun:stun.relay.metered.ca:80",
            },
            {
              urls: "turn:global.relay.metered.ca:80",
              username: "5445e58580409e5dd00a8ffc",
              credential: "Rt6yzNe4/iSwC4TE",
            },
            {
              urls: "turn:global.relay.metered.ca:80?transport=tcp",
              username: "5445e58580409e5dd00a8ffc",
              credential: "Rt6yzNe4/iSwC4TE",
            },
            {
              urls: "turn:global.relay.metered.ca:443",
              username: "5445e58580409e5dd00a8ffc",
              credential: "Rt6yzNe4/iSwC4TE",
            },
            {
              urls: "turns:global.relay.metered.ca:443?transport=tcp",
              username: "5445e58580409e5dd00a8ffc",
              credential: "Rt6yzNe4/iSwC4TE",
            },
        ],
      });
      if (localStream) {
        localStream.getTracks().forEach(track => pc.addTrack(track, localStream));
      }
      pc.onicecandidate = (e) => {
        if (e.candidate) {
          socket.emit('voice-ice', { roomCode, to: peerId, candidate: e.candidate });
        }
      };
      pc.ontrack = (e) => {
        console.log("🎧 استلمت صوت من:", peerId, e.streams);
        const audio = createRemoteAudioEl(peerId);
        audio.srcObject = e.streams[0];
        audio.autoplay = true;
        audio.playsInline = true;  // مهم للموبايل
        audio.muted = !speakersOn; 
        audio.play().catch(err => console.warn("فشل تشغيل الصوت:", err));
      };
      document.body.addEventListener('click', () => {
        Object.values(peerAudioEls).forEach(a => {
          a.play().catch(()=>{});
        });
      });
      socket.on("voice-receive", (stream) => {
        console.log("🎧 استلمت صوت من:", stream);
        // أنشئ أو جِب عنصر <audio>
        let audio = document.getElementById("remoteAudio");
        if (!audio) {
          audio = document.createElement("audio");
          audio.id = "remoteAudio";
          audio.autoplay = true; // مهم: يشغل مباشرة
          document.body.appendChild(audio);
        }
        // اربط الـ stream بالصوت
        audio.srcObject = stream;
      });
      pc.onconnectionstatechange = () => {
        if (['failed','disconnected','closed'].includes(pc.connectionState)) {
          removePeer(peerId);
        }
      };

      peers[peerId] = pc;
      return pc;
    }

    async function callPeer(peerId) {
      const pc = peers[peerId] || createPeerConnection(peerId);
      const offer = await pc.createOffer({ offerToReceiveAudio: true });
      await pc.setLocalDescription(offer);
      socket.emit('voice-offer', { roomCode, to: peerId, offer });
    }

    // عند الدخول للغرفة
    socket.emit('voice-join', { roomCode, playerName });

    socket.on('voice-peers', async ({ ids }) => {
      for (const id of ids) {
        if (socket.id < id) { // أنا أبدأ فقط لو آي دي تبعي أصغر
          await callPeer(id);
        }
      }
    });

    socket.on('voice-peer-joined', async ({ id }) => {
      // فقط طرف واحد يبادر
      if (socket.id < id) {
        // لا توقف الميك داخل removePeer!
        removePeer(id);
        await callPeer(id);
      }
    });

    // استقبال اتصال صوتي
    socket.on("voice-offer", async ({ from, offer }) => {
      const pc = peers[from] || createPeerConnection(from);

      await pc.setRemoteDescription(new RTCSessionDescription(offer));
      const answer = await pc.createAnswer({ offerToReceiveAudio: true });
      await pc.setLocalDescription(answer);

      socket.emit("voice-answer", { roomCode, to: from, answer });
    });

    socket.on('voice-answer', async ({ from, answer }) => {
      const pc = peers[from];
      if (pc && answer) {
        await pc.setRemoteDescription(new RTCSessionDescription(answer));

        // أعد تشغيل الأصوات للتأكد
        Object.values(peerAudioEls).forEach(a => {
          if (speakersOn) a.play().catch(()=>{});
        });
      }
    });


    socket.on('voice-ice', async ({ from, candidate }) => {
      const pc = peers[from];
      if (pc && candidate) {
        try { await pc.addIceCandidate(new RTCIceCandidate(candidate)); } catch {}
      }
    });

    socket.on('voice-peer-left', ({ id }) => {
      removePeer(id);
    });

    // زر الميكروفون
    document.getElementById('micButton')?.addEventListener('click', async () => {
      try {
        if (!localStream) {
          // طلب إذن المايك أول مرة
          localStream = await navigator.mediaDevices.getUserMedia({ audio: true });
          micOn = true;

          // أضف الصوت لكل اتصال مفتوح
          Object.values(peers).forEach(pc => {
            localStream.getTracks().forEach(track => {
              pc.addTrack(track, localStream);
              track.enabled = true; // تأكد انه شغال
            });
          });

          console.log("🎤 الميكروفون اشتغل على الهاتف/الكمبيوتر");
        } else {
          // تشغيل/إيقاف المايك
          micOn = !micOn;
          localStream.getTracks().forEach(track => track.enabled = micOn);
        }

        updateMicIcon();
      } catch (err) {
        console.error('فشل تشغيل الميكروفون:', err);
        alert('تأكد أنك سمحت للمتصفح بالوصول للمايكروفون.');
      }
    });


    // زر السماعة
    document.getElementById('speakerButton')?.addEventListener('click', () => {
      speakersOn = !speakersOn;
      updateSpeakerIcon();

      Object.values(peerAudioEls).forEach(a => {
        a.muted = !speakersOn;
        if (speakersOn) {
          a.play().catch(err => console.warn("فشل تشغيل الصوت:", err));
        }
      });
    });


    updateMicIcon();
    updateSpeakerIcon();

    // إعادة الاتصال عند الرجوع للصفحة
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible' && socket && !socket.connected) {
        socket.connect();
        socket.emit('voice-join', { roomCode, playerName });
      }
    });






  </script>
  <audio id="voteSound" src="sounds/vote.mp3"></audio>
  <audio id="kickSound" src="sounds/kick.mp3"></audio>
  <audio id="giftSound" src="sounds/gift.mp3"></audio>

  <audio id="sound-rose" src="sounds/rose.mp3"></audio>
  <audio id="sound-tomato" src="sounds/rose.mp3"></audio>
  <audio id="sound-bomb" src="sounds/bomb.mp3"></audio>
  <audio id="sound-donkey" src="sounds/Donkey .mp3"></audio>
  <audio id="kickCitizenSound" src="sounds/mafia.mp3"></audio>
  <audio id="kickMafiaSound" src="sounds/moatn.mp3"></audio>
  <audio id="a" src="sounds/mafia.mp3"></audio>
  <audio id="b" src="sounds/moatn.mp3"></audio>
</body>
</html>
